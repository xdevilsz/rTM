<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ResTM Admin Reports</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #0a0d12;
      --panel: rgba(20, 28, 39, 0.88);
      --border: rgba(61, 77, 102, 0.45);
      --text: #e7edf7;
      --muted: #a6b4c8;
      --accent: #7cc4ff;
      --shadow: 0 18px 40px rgba(3, 8, 20, 0.45);
    }
    body {
      font-family: "Inter", "SF Pro Text", "Segoe UI", system-ui, -apple-system, sans-serif;
      background:
        radial-gradient(900px 500px at 10% -10%, rgba(124, 196, 255, 0.18), transparent 60%),
        radial-gradient(900px 500px at 90% -20%, rgba(155, 140, 255, 0.12), transparent 55%),
        var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px;
    }
    h1 { margin: 0 0 8px; font-size: 24px; }
    .muted { color: var(--muted); }
    .card {
      background: linear-gradient(135deg, rgba(30, 40, 56, 0.7), rgba(19, 28, 40, 0.92));
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      box-shadow: var(--shadow);
      max-width: 900px;
    }
    .controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 12px; }
    label { font-size: 12px; color: var(--muted); }
    input, select, button {
      background: rgba(20, 28, 39, 0.8);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 6px 10px;
    }
    button {
      cursor: pointer;
      border-color: rgba(124, 196, 255, 0.35);
      background: linear-gradient(135deg, rgba(124, 196, 255, 0.2), rgba(155, 140, 255, 0.16));
    }
    .status { margin-top: 12px; font-size: 12px; color: var(--muted); }
    .disabled { opacity: 0.6; pointer-events: none; }
  </style>
</head>
<body>
  <h1>ResTM Admin Reports</h1>
  <div class="muted">Admin-only reporting tool (PDF / PPTX).</div>
  <div class="card" id="admin_card">
    <div class="controls">
      <label>Symbol
        <input id="symbol" placeholder="ALL" />
      </label>
      <label>Days
        <select id="days">
          <option value="7">7</option>
          <option value="14">14</option>
          <option value="30" selected>30</option>
          <option value="60">60</option>
          <option value="90">90</option>
        </select>
      </label>
      <label>Start
        <input id="start" type="date" />
      </label>
      <label>End
        <input id="end" type="date" />
      </label>
      <label>Format
        <select id="format">
          <option value="pdf">PDF</option>
          <option value="pptx">PPTX</option>
        </select>
      </label>
      <button id="generate">Generate Report</button>
    </div>
    <div class="status" id="status">Ready.</div>
  </div>

  <script>
    async function checkAdmin() {
      try {
        const res = await fetch('/api/admin/status', { cache: 'no-store' });
        const data = await res.json();
        if (!data.ok) {
          const card = document.getElementById('admin_card');
          card.classList.add('disabled');
          document.getElementById('status').textContent = 'Admin disabled. Create admin_config.json to enable.';
        }
      } catch (e) {
        document.getElementById('status').textContent = 'Admin status unavailable.';
      }
    }

    function buildUrl() {
      const symbol = (document.getElementById('symbol').value || '').trim();
      const days = document.getElementById('days').value;
      const start = document.getElementById('start').value;
      const end = document.getElementById('end').value;
      const format = document.getElementById('format').value;
      const qs = new URLSearchParams({ days, format });
      if (symbol) qs.set('symbol', symbol);
      if (start) qs.set('start', start);
      if (end) qs.set('end', end);
      return `/api/admin/report?${qs.toString()}`;
    }

    document.getElementById('generate').addEventListener('click', () => {
      const url = buildUrl();
      window.location.href = url;
      document.getElementById('status').textContent = 'Generating report...';
    });

    checkAdmin();
  </script>
</body>
</html>
